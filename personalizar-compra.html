<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GUZZOCORP - Personalizar Compra</title>
    <meta name="description" content="Personaliza tu compra en GUZZOCORP">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="icon" type="image/png" href="GuzzoCorp.png">
</head>
<body>
    <div class="personalizar-container">
        <h1 class="neon-accent">Personaliza tu compra</h1>
        
        <div class="producto-layout">
            <!-- Secci√≥n izquierda: Imagen grande -->
            <div class="producto-imagen-grande">
                <img id="producto-imagen" src="" alt="Imagen del producto">
            </div>
            
            <!-- Secci√≥n derecha: Detalles y formulario -->
            <div class="producto-detalles">
                <h2 id="producto-nombre"></h2>
                <p class="precio" id="producto-precio"></p>
                <p class="descripcion" id="producto-descripcion"></p>
                
                <form id="formulario-compra">
                    <div class="form-group">
                        <label for="talle">Talle:</label>
                        <select id="talle" name="talle" required></select>
                    </div>
                    
                    <div class="form-group">
                        <label for="color">Color:</label>
                        <select id="color" name="color" required></select>
                    </div>
                    
                    <div class="form-group">
                        <label for="cantidad">Cantidad:</label>
                        <input type="number" id="cantidad" name="cantidad" min="1" value="1" required>
                    </div>
                    
                    <div class="resumen-pago">
                        <h3>Resumen</h3>
                        <div id="resumen-detalle"></div>
                    </div>
                    
                    <button type="submit" class="cta-button">
                        <i class="fab fa-whatsapp"></i> FINALIZAR COMPRA
                    </button>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Cargar productos primero
        fetch('catalog.js')
            .then(response => response.text())
            .then(data => {
                // Extraer el array products del archivo JS
                const script = document.createElement('script');
                script.textContent = data;
                document.head.appendChild(script);
                
                // Ahora podemos acceder a la variable products
                const params = new URLSearchParams(window.location.search);
                const idProducto = parseInt(params.get("producto"));
                const producto = products.find(p => p.id === idProducto);
                
                if (producto) {
                    // Llenar datos del producto
                    document.getElementById('producto-imagen').src = producto.image;
                    document.getElementById('producto-nombre').textContent = producto.name;
                    document.getElementById('producto-precio').textContent = `$${producto.price.toLocaleString('es-AR')}`;
                    document.getElementById('producto-descripcion').textContent = producto.description;
                    
                    // Llenar talles
                    const selectTalle = document.getElementById('talle');
                    if (producto.sizes && producto.sizes.length > 0) {
                        producto.sizes.forEach(talle => {
                            const option = document.createElement('option');
                            option.value = talle;
                            option.textContent = talle;
                            selectTalle.appendChild(option);
                        });
                    } else {
                        const option = document.createElement('option');
                        option.value = "unico";
                        option.textContent = "Talle √∫nico";
                        selectTalle.appendChild(option);
                    }
                    
                    // Llenar colores
                    const selectColor = document.getElementById('color');
                    const colores = producto.colors || ["Negro", "Blanco", "Gris"];
                    colores.forEach(color => {
                        const option = document.createElement('option');
                        option.value = color;
                        option.textContent = color;
                        selectColor.appendChild(option);
                    });
                    
                    // Actualizar resumen
                    function actualizarResumen() {
                        const cantidad = parseInt(document.getElementById('cantidad').value) || 1;
                        const talle = selectTalle.value;
                        const color = selectColor.value;
                        let descuento = 0;
                        
                        if (cantidad >= 3) descuento = 10;
                        else if (cantidad >= 2) descuento = 3;
                        
                        const total = producto.price * cantidad * (1 - descuento/100);
                        
                        document.getElementById('resumen-detalle').innerHTML = `
                            <p>${cantidad} x $${producto.price.toLocaleString('es-AR')}</p>
                            ${descuento > 0 ? `<p class="descuento">Descuento ${descuento}%</p>` : ''}
                            <p class="total">Total: $${total.toLocaleString('es-AR')}</p>
                        `;
                    }
                    
                    // Event listeners
                    document.getElementById('cantidad').addEventListener('change', actualizarResumen);
                    selectTalle.addEventListener('change', actualizarResumen);
                    selectColor.addEventListener('change', actualizarResumen);
                    
                    // Form submit
                    document.getElementById('formulario-compra').addEventListener('submit', function(e) {
                        e.preventDefault();
                        
                        const cantidad = parseInt(document.getElementById('cantidad').value) || 1;
                        const talle = selectTalle.value;
                        const color = selectColor.value;
                        let descuento = 0;
                        
                        if (cantidad >= 3) descuento = 10;
                        else if (cantidad >= 2) descuento = 3;
                        
                        const total = producto.price * cantidad * (1 - descuento/100);
                        
                        const mensaje = `¬°Hola GUZZOCORP! üëã\n\nQuiero comprar:\n\n*Producto:* ${producto.name}\n*Talle:* ${talle}\n*Color:* ${color}\n*Cantidad:* ${cantidad}\n*Precio unitario:* $${producto.price.toLocaleString('es-AR')}\n${descuento > 0 ? `*Descuento:* ${descuento}%\n` : ''}*Total:* $${total.toLocaleString('es-AR')}\n\n[Ver producto](${producto.image})\n\nMis datos:\n- Nombre: \n- Direcci√≥n: \n- M√©todo de pago: (Efectivo/Transferencia)\n\n¬°Gracias!`;
                        
                        window.open(`https://wa.me/5492664633010?text=${encodeURIComponent(mensaje)}`, '_blank');
                    });
                    
                    // Inicializar resumen
                    actualizarResumen();
                } else {
                    document.querySelector('.personalizar-container').innerHTML = `
                        <div class="error">
                            <p>Producto no encontrado</p>
                            <a href="catalogo.html" class="cta-button">Volver al cat√°logo</a>
                        </div>
                    `;
                }
            });
    </script>
</body>
</html>
